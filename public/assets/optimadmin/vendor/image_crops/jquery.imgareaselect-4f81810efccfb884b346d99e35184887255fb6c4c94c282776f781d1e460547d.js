/*
 * imgAreaSelect jQuery plugin
 * version 0.9.10
 *
 * Copyright (c) 2008-2013 Michal Wojciechowski (odyniec.net)
 *
 * Dual licensed under the MIT (MIT-LICENSE.txt)
 * and GPL (GPL-LICENSE.txt) licenses.
 *
 * http://odyniec.net/projects/imgareaselect/
 *
 */
!function(e){function t(){return e("<div/>")}var n=Math.abs,i=Math.max,r=Math.min,o=Math.round;e.imgAreaSelect=function(a,s){function l(e){return e+ge.left-ve.left}function c(e){return e+ge.top-ve.top}function u(e){return e-ge.left+ve.left}function d(e){return e-ge.top+ve.top}function f(e){return e.pageX-ve.left}function h(e){return e.pageY-ve.top}function p(e){var t=e||q,n=e||U;return{x1:o(xe.x1*t),y1:o(xe.y1*n),x2:o(xe.x2*t),y2:o(xe.y2*n),width:o(xe.x2*t)-o(xe.x1*t),height:o(xe.y2*n)-o(xe.y1*n)}}function m(e,t,n,i,r){var a=r||q,s=r||U;xe={x1:o(e/a||0),y1:o(t/s||0),x2:o(n/a||0),y2:o(i/s||0)},xe.width=xe.x2-xe.x1,xe.height=xe.y2-xe.y1}function g(){H&&ue.width()&&(ge={left:o(ue.offset().left),top:o(ue.offset().top)},F=ue.innerWidth(),B=ue.innerHeight(),ge.top+=ue.outerHeight()-B>>1,ge.left+=ue.outerWidth()-F>>1,V=o(s.minWidth/q)||0,K=o(s.minHeight/U)||0,X=o(r(s.maxWidth/q||1<<24,F)),J=o(r(s.maxHeight/U||1<<24,B)),"1.3.2"!=e().jquery||"fixed"!=be||we.getBoundingClientRect||(ge.top+=i(document.body.scrollTop,we.scrollTop),ge.left+=i(document.body.scrollLeft,we.scrollLeft)),ve=/absolute|relative/.test(W.css("position"))?{left:o(W.offset().left)-W.scrollLeft(),top:o(W.offset().top)-W.scrollTop()}:"fixed"==be?{left:e(document).scrollLeft(),top:e(document).scrollTop()}:{left:0,top:0},L=l(0),$=c(0),(xe.x2>F||xe.y2>B)&&_())}function v(t){if(Q){switch(de.css({left:l(xe.x1),top:c(xe.y1)}).add(fe).width(se=xe.width).height(le=xe.height),fe.add(he).add(me).css({left:0,top:0}),he.width(i(se-he.outerWidth()+he.innerWidth(),0)).height(i(le-he.outerHeight()+he.innerHeight(),0)),e(pe[0]).css({left:L,top:$,width:xe.x1,height:B}),e(pe[1]).css({left:L+xe.x1,top:$,width:se,height:xe.y1}),e(pe[2]).css({left:L+xe.x2,top:$,width:F-xe.x2,height:B}),e(pe[3]).css({left:L+xe.x1,top:$+xe.y2,width:se,height:B-xe.y2}),se-=me.outerWidth(),le-=me.outerHeight(),me.length){case 8:e(me[4]).css({left:se>>1}),e(me[5]).css({left:se,top:le>>1}),e(me[6]).css({left:se>>1,top:le}),e(me[7]).css({top:le>>1});case 4:me.slice(1,3).css({left:se}),me.slice(2,4).css({top:le})}t!==!1&&(e.imgAreaSelect.onKeyPress!=ke&&e(document).unbind(e.imgAreaSelect.keyPress,e.imgAreaSelect.onKeyPress),s.keys&&e(document)[e.imgAreaSelect.keyPress](e.imgAreaSelect.onKeyPress=ke)),_e&&he.outerWidth()-he.innerWidth()==2&&(he.css("margin",0),setTimeout(function(){he.css("margin","auto")},0))}}function y(e){g(),v(e),Z=l(xe.x1),ee=c(xe.y1),te=l(xe.x2),ne=c(xe.y2)}function b(e,t){s.fadeSpeed?e.fadeOut(s.fadeSpeed,t):e.hide()}function x(e){var t=u(f(e))-xe.x1,n=d(h(e))-xe.y1;ce||(g(),ce=!0,de.one("mouseout",function(){ce=!1})),Y="",s.resizable&&(n<=s.resizeMargin?Y="n":n>=xe.height-s.resizeMargin&&(Y="s"),t<=s.resizeMargin?Y+="w":t>=xe.width-s.resizeMargin&&(Y+="e")),de.css("cursor",Y?Y+"-resize":s.movable?"move":""),I&&I.toggle()}function w(t){e("body").css("cursor",""),(s.autoHide||xe.width*xe.height==0)&&b(de.add(pe),function(){e(this).hide()}),e(document).unbind("mousemove",T),de.mousemove(x),s.onSelectEnd(a,p())}function C(t){return 1!=t.which?!1:(g(),Y?(e("body").css("cursor",Y+"-resize"),Z=l(xe[/w/.test(Y)?"x2":"x1"]),ee=c(xe[/n/.test(Y)?"y2":"y1"]),e(document).mousemove(T).one("mouseup",w),de.unbind("mousemove",x)):s.movable?(j=L+xe.x1-f(t),z=$+xe.y1-h(t),de.unbind("mousemove",x),e(document).mousemove(D).one("mouseup",function(){s.onSelectEnd(a,p()),e(document).unbind("mousemove",D),de.mousemove(x)})):ue.mousedown(t),!1)}function k(e){G&&(e?(te=i(L,r(L+F,Z+n(ne-ee)*G*(te>Z||-1))),ne=o(i($,r($+B,ee+n(te-Z)/G*(ne>ee||-1)))),te=o(te)):(ne=i($,r($+B,ee+n(te-Z)/G*(ne>ee||-1))),te=o(i(L,r(L+F,Z+n(ne-ee)*G*(te>Z||-1)))),ne=o(ne)))}function _(){Z=r(Z,L+F),ee=r(ee,$+B),n(te-Z)<V&&(te=Z-V*(Z>te||-1),L>te?Z=L+V:te>L+F&&(Z=L+F-V)),n(ne-ee)<K&&(ne=ee-K*(ee>ne||-1),$>ne?ee=$+K:ne>$+B&&(ee=$+B-K)),te=i(L,r(te,L+F)),ne=i($,r(ne,$+B)),k(n(te-Z)<n(ne-ee)*G),n(te-Z)>X&&(te=Z-X*(Z>te||-1),k()),n(ne-ee)>J&&(ne=ee-J*(ee>ne||-1),k(!0)),xe={x1:u(r(Z,te)),x2:u(i(Z,te)),y1:d(r(ee,ne)),y2:d(i(ee,ne)),width:n(te-Z),height:n(ne-ee)},v(),s.onSelectChange(a,p())}function T(e){return te=/w|e|^$/.test(Y)||G?f(e):l(xe.x2),ne=/n|s|^$/.test(Y)||G?h(e):c(xe.y2),_(),!1}function S(t,n){te=(Z=t)+xe.width,ne=(ee=n)+xe.height,e.extend(xe,{x1:u(Z),y1:d(ee),x2:u(te),y2:d(ne)}),v(),s.onSelectChange(a,p())}function D(e){return Z=i(L,r(j+f(e),L+F-xe.width)),ee=i($,r(z+h(e),$+B-xe.height)),S(Z,ee),e.preventDefault(),!1}function E(){e(document).unbind("mousemove",E),g(),te=Z,ne=ee,_(),Y="",pe.is(":visible")||de.add(pe).hide().fadeIn(s.fadeSpeed||0),Q=!0,e(document).unbind("mouseup",N).mousemove(T).one("mouseup",w),de.unbind("mousemove",x),s.onSelectStart(a,p())}function N(){e(document).unbind("mousemove",E).unbind("mouseup",N),b(de.add(pe)),m(u(Z),d(ee),u(Z),d(ee)),this instanceof e.imgAreaSelect||(s.onSelectChange(a,p()),s.onSelectEnd(a,p()))}function A(t){return 1!=t.which||pe.is(":animated")?!1:(g(),j=Z=f(t),z=ee=h(t),e(document).mousemove(E).mouseup(N),!1)}function M(){y(!1)}function R(){H=!0,P(s=e.extend({classPrefix:"imgareaselect",movable:!0,parent:"body",resizable:!0,resizeMargin:10,onInit:function(){},onSelectStart:function(){},onSelectChange:function(){},onSelectEnd:function(){}},s)),de.add(pe).css({visibility:""}),s.show&&(Q=!0,g(),v(),de.add(pe).hide().fadeIn(s.fadeSpeed||0)),setTimeout(function(){s.onInit(a,p())},0)}function O(e,t){for(var n in t)void 0!==s[n]&&e.css(t[n],s[n])}function P(n){if(n.parent&&(W=e(n.parent)).append(de.add(pe)),e.extend(s,n),g(),null!=n.handles){for(me.remove(),me=e([]),oe=n.handles?"corners"==n.handles?4:8:0;oe--;)me=me.add(t());me.addClass(s.classPrefix+"-handle").css({position:"absolute",fontSize:0,zIndex:ye+1||1}),!parseInt(me.css("width"))>=0&&me.width(5).height(5),(ae=s.borderWidth)&&me.css({borderWidth:ae,borderStyle:"solid"}),O(me,{borderColor1:"border-color",borderColor2:"background-color",borderOpacity:"opacity"})}for(q=s.imageWidth/F||1,U=s.imageHeight/B||1,null!=n.x1&&(m(n.x1,n.y1,n.x2,n.y2),n.show=!n.hide),n.keys&&(s.keys=e.extend({shift:1,ctrl:"resize"},n.keys)),pe.addClass(s.classPrefix+"-outer"),fe.addClass(s.classPrefix+"-selection"),oe=0;oe++<4;)e(he[oe-1]).addClass(s.classPrefix+"-border"+oe);O(fe,{selectionColor:"background-color",selectionOpacity:"opacity"}),O(he,{borderOpacity:"opacity",borderWidth:"border-width"}),O(pe,{outerColor:"background-color",outerOpacity:"opacity"}),(ae=s.borderColor1)&&e(he[0]).css({borderStyle:"solid",borderColor:ae}),(ae=s.borderColor2)&&e(he[1]).css({borderStyle:"dashed",borderColor:ae}),de.append(fe.add(he).add(I)).append(me),_e&&((ae=(pe.css("filter")||"").match(/opacity=(\d+)/))&&pe.css("opacity",ae[1]/100),(ae=(he.css("filter")||"").match(/opacity=(\d+)/))&&he.css("opacity",ae[1]/100)),n.hide?b(de.add(pe)):n.show&&H&&(Q=!0,de.add(pe).fadeIn(s.fadeSpeed||0),y()),G=(re=(s.aspectRatio||"").split(/:/))[0]/re[1],ue.add(pe).unbind("mousedown",A),s.disable||s.enable===!1?(de.unbind("mousemove",x).unbind("mousedown",C),e(window).unbind("resize",M)):((s.enable||s.disable===!1)&&((s.resizable||s.movable)&&de.mousemove(x).mousedown(C),e(window).resize(M)),s.persistent||ue.add(pe).mousedown(A)),s.enable=s.disable=void 0}var H,I,L,$,F,B,W,j,z,q,U,Y,V,K,X,J,G,Q,Z,ee,te,ne,ie,re,oe,ae,se,le,ce,ue=e(a),de=t(),fe=t(),he=t().add(t()).add(t()).add(t()),pe=t().add(t()).add(t()).add(t()),me=e([]),ge={left:0,top:0},ve={left:0,top:0},ye=0,be="absolute",xe={x1:0,y1:0,x2:0,y2:0,width:0,height:0},we=document.documentElement,Ce=navigator.userAgent,ke=function(e){var t,n,o=s.keys,a=e.keyCode;if(t=isNaN(o.alt)||!e.altKey&&!e.originalEvent.altKey?!isNaN(o.ctrl)&&e.ctrlKey?o.ctrl:!isNaN(o.shift)&&e.shiftKey?o.shift:isNaN(o.arrows)?10:o.arrows:o.alt,"resize"==o.arrows||"resize"==o.shift&&e.shiftKey||"resize"==o.ctrl&&e.ctrlKey||"resize"==o.alt&&(e.altKey||e.originalEvent.altKey)){switch(a){case 37:t=-t;case 39:n=i(Z,te),Z=r(Z,te),te=i(n+t,Z),k();break;case 38:t=-t;case 40:n=i(ee,ne),ee=r(ee,ne),ne=i(n+t,ee),k(!0);break;default:return}_()}else switch(Z=r(Z,te),ee=r(ee,ne),a){case 37:S(i(Z-t,L),ee);break;case 38:S(Z,i(ee-t,$));break;case 39:S(Z+r(t,F-u(te)),ee);break;case 40:S(Z,ee+r(t,B-d(ne)));break;default:return}return!1};this.remove=function(){P({disable:!0}),de.add(pe).remove()},this.getOptions=function(){return s},this.setOptions=P,this.getSelection=p,this.setSelection=m,this.cancelSelection=N,this.update=y;var _e=(/msie ([\w.]+)/i.exec(Ce)||[])[1],Te=/opera/i.test(Ce),Se=/webkit/i.test(Ce)&&!/chrome/i.test(Ce);for(ie=ue;ie.length;)ye=i(ye,isNaN(ie.css("z-index"))?ye:ie.css("z-index")),"fixed"==ie.css("position")&&(be="fixed"),ie=ie.parent(":not(body)");ye=s.zIndex||ye,_e&&ue.attr("unselectable","on"),e.imgAreaSelect.keyPress=_e||Se?"keydown":"keypress",Te&&(I=t().css({width:"100%",height:"100%",position:"absolute",zIndex:ye+2||2})),de.add(pe).css({visibility:"hidden",position:be,overflow:"hidden",zIndex:ye||"0"}),de.css({zIndex:ye+2||2}),fe.add(he).css({position:"absolute",fontSize:0}),a.complete||"complete"==a.readyState||!ue.is("img")?R():ue.one("load",R),!H&&_e&&_e>=7&&(a.src=a.src)},e.fn.imgAreaSelect=function(t){return t=t||{},this.each(function(){e(this).data("imgAreaSelect")?t.remove?(e(this).data("imgAreaSelect").remove(),e(this).removeData("imgAreaSelect")):e(this).data("imgAreaSelect").setOptions(t):t.remove||(void 0===t.enable&&void 0===t.disable&&(t.enable=!0),e(this).data("imgAreaSelect",new e.imgAreaSelect(this,t)))}),t.instance?e(this).data("imgAreaSelect"):this}}(jQuery);